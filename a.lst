     1                                  section .text
     2                                  
     3                                  global mystrcmp
     4                                  ; extern strlen
     5                                  
     6                                  ; mystrcmp:
     7                                  ;     mov [rel RetOffs], rbp
     8                                  ;     pop rbp
     9                                  ;
    10                                  ;     lea rax, [rel my_strcmp]
    11                                  ;     call rax
    12                                  ;
    13                                  ;     push rbp
    14                                  ;     mov rbp, [rel RetOffs]
    15                                  ;     ret
    16                                  
    17                                  mystrcmp:
    18 00000000 55                          push rbp
    19                                  
    20 00000001 4887FE                      xchg rsi, rdi
    21                                  ;     lea rax, [rel mystrlen]
    22                                  ;     call rax
    23                                  ;
    24                                  ;     mov rcx, rax
    25                                  ;
    26                                  ;     mov edx, 1
    27                                  ;     shl edx, cl
    28                                  ;     dec edx
    29                                  ;     not edx
    30                                  
    31 00000004 C5FE6F06                    vmovdqu ymm0, [rsi]
    32 00000008 C5FE6F0F                    vmovdqu ymm1, [rdi]
    33                                  
    34 0000000C C5FD74D1                    vpcmpeqb ymm2, ymm0, ymm1
    35 00000010 C5FD74D8                    vpcmpeqb ymm3, ymm0, ymm0
    36 00000014 C5FD74E3                    vpcmpeqb ymm4, ymm0, ymm3
    37                                  
    38 00000018 C5FDD7D2                    vpmovmskb edx, ymm2
    39 0000001C C5FDD7C2                    vpmovmskb eax, ymm2
    40 00000020 09D0                        or eax, edx
    41 00000022 39D0                        cmp eax, edx
    42 00000024 7505                        jne .not_equal
    43                                  
    44                                  .equal:
    45 00000026 4831C0                     xor rax, rax
    46 00000029 EB00                       jmp .done
    47                                  .not_equal:
    48                                      ; mov rax, 1
    49                                  
    50                                  .done:
    51 0000002B 5D                          pop rbp
    52 0000002C C3                          ret
    53                                  
    54                                  
    55                                  
    56                                  mystrlen:
    57 0000002D 48C7C1FFFFFFFF              mov rcx, -1
    58 00000034 30C0                        xor al, al
    59 00000036 F2AE                        repne scasb
    60 00000038 48F7D1                      not rcx
    61 0000003B 48FFC9                      dec rcx
    62 0000003E 4889C8                      mov rax, rcx
    63 00000041 C3                          ret
    64                                  
    65                                  section .data
    66 00000000 0000000000000000        RetOffs         dq  0
